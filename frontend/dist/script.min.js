class CalculatorApp{constructor(){this.apiUrl=window.API_URL||"",this.display=document.getElementById("display"),this.expression=document.getElementById("expression"),this.historyList=document.getElementById("history-list"),this.apiIndicator=document.getElementById("api-indicator"),this.apiStatusText=document.getElementById("api-status-text"),this.currentValue="0",this.previousValue=null,this.operation=null,this.shouldResetDisplay=!1,this.init()}init(){this.setupEventListeners(),this.setupKeyboardShortcuts(),this.loadTheme(),this.checkApiHealth(),this.loadHistory()}setupEventListeners(){document.querySelectorAll("[data-number]").forEach(t=>{t.addEventListener("click",()=>this.handleNumber(t.dataset.number))}),document.querySelectorAll("[data-operation]").forEach(t=>{t.addEventListener("click",()=>this.handleOperation(t.dataset.operation))}),document.querySelectorAll("[data-action]").forEach(t=>{t.addEventListener("click",()=>this.handleAction(t.dataset.action))}),document.getElementById("theme-toggle")?.addEventListener("click",()=>this.toggleTheme()),document.getElementById("clear-history")?.addEventListener("click",()=>this.clearHistory())}setupKeyboardShortcuts(){document.addEventListener("keydown",t=>{t.key>="0"&&t.key<="9"||"."===t.key?this.handleNumber(t.key):"+"===t.key?this.handleOperation("add"):"-"===t.key?this.handleOperation("subtract"):"*"===t.key?this.handleOperation("multiply"):"/"===t.key?(t.preventDefault(),this.handleOperation("divide")):"Enter"===t.key||"="===t.key?this.handleAction("equals"):"Escape"===t.key||"c"===t.key?this.handleAction("clear"):"Backspace"===t.key&&this.handleAction("delete")})}handleNumber(t){if(this.shouldResetDisplay)this.currentValue="."===t?"0.":t,this.shouldResetDisplay=!1;else{if("."===t&&this.currentValue.includes("."))return;this.currentValue="0"===this.currentValue&&"."!==t?t:this.currentValue+t}this.updateDisplay()}async handleOperation(t){const e=parseFloat(this.currentValue);"sqrt"!==t?(null!==this.previousValue&&this.operation&&!this.shouldResetDisplay&&await this.calculate(this.operation,this.previousValue,e),this.previousValue=parseFloat(this.currentValue),this.operation=t,this.shouldResetDisplay=!0,this.updateExpression()):await this.calculate("sqrt",e,null)}async handleAction(t){switch(t){case"clear":this.clear();break;case"delete":this.delete();break;case"equals":if(this.operation&&null!==this.previousValue){const t=parseFloat(this.currentValue);await this.calculate(this.operation,this.previousValue,t),this.operation=null,this.previousValue=null,this.updateExpression()}}}async calculate(t,e,i){try{const s=await fetch(`${this.apiUrl}/api/calculate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operation:t,a:e,b:i})});if(!s.ok){const t=await s.json();throw new Error(t.error||"BÅ‚Ä…d obliczeÅ„")}const a=await s.json();return this.currentValue=a.result.toString(),this.updateDisplay(),this.shouldResetDisplay=!0,await this.loadHistory(),a.result}catch(t){throw this.showError(t.message),t}}clear(){this.currentValue="0",this.previousValue=null,this.operation=null,this.shouldResetDisplay=!1,this.updateDisplay(),this.updateExpression()}delete(){this.shouldResetDisplay||(this.currentValue=this.currentValue.length>1?this.currentValue.slice(0,-1):"0",this.updateDisplay())}updateDisplay(){this.display.value=this.currentValue}updateExpression(){if(null!==this.previousValue&&this.operation){const t={add:"+",subtract:"âˆ’",multiply:"Ã—",divide:"Ã·",power:"^"};this.expression.textContent=`${this.previousValue} ${t[this.operation]||this.operation}`}else this.expression.textContent=""}async loadHistory(){try{const t=await fetch(`${this.apiUrl}/api/history`),e=await t.json();this.displayHistory(e)}catch(t){console.error("BÅ‚Ä…d Å‚adowania historii:",t)}}displayHistory(t){if(!this.historyList)return;if(0===t.length)return void(this.historyList.innerHTML='<p class="empty">Brak historii</p>');const e={add:"+",subtract:"âˆ’",multiply:"Ã—",divide:"Ã·",power:"^",sqrt:"âˆš"};this.historyList.innerHTML=t.reverse().map(t=>{const i=e[t.operation]||t.operation;return`<div class="history-item">${null!==t.b?`${t.a} ${i} ${t.b}`:`${i}${t.a}`} = ${t.result}</div>`}).join("")}async clearHistory(){try{await fetch(`${this.apiUrl}/api/history`,{method:"DELETE"}),await this.loadHistory()}catch(t){this.showError("BÅ‚Ä…d czyszczenia historii")}}async checkApiHealth(){try{(await fetch(`${this.apiUrl}/api/health`)).ok?this.setApiStatus(!0):this.setApiStatus(!1)}catch(t){this.setApiStatus(!1)}}setApiStatus(t){t?(this.apiIndicator.className="indicator online",this.apiStatusText.textContent="PoÅ‚Ä…czono z API"):(this.apiIndicator.className="indicator offline",this.apiStatusText.textContent="Brak poÅ‚Ä…czenia z API")}showError(t){this.currentValue="Error",this.updateDisplay(),console.error(t),setTimeout(()=>{this.clear()},2e3)}toggleTheme(){const t="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("calculator-theme",t);const e=document.getElementById("theme-toggle");e&&(e.textContent="dark"===t?"â˜€ï¸":"ðŸŒ™")}loadTheme(){const t=localStorage.getItem("calculator-theme")||"light";document.documentElement.setAttribute("data-theme",t);const e=document.getElementById("theme-toggle");e&&(e.textContent="dark"===t?"â˜€ï¸":"ðŸŒ™")}}"undefined"!=typeof window&&document.addEventListener("DOMContentLoaded",()=>{window.calculatorApp=new CalculatorApp}),"undefined"!=typeof module&&module.exports&&(module.exports=CalculatorApp);